(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function a(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=a(o);fetch(o.href,u)}})();var ae;(function(e){e[e.trace=10]="trace",e[e.debug=20]="debug",e[e.info=30]="info",e[e.warn=40]="warn",e[e.error=50]="error",e[e.fatal=60]="fatal",e[e.silent=9007199254740991]="silent"})(ae||(ae={}));function ge(){return Object.freeze({fatal:(e,t)=>console.error(t,e),error:(e,t)=>console.error(t,e),warn:(e,t)=>console.warn(t,e),info:(e,t)=>console.info(t,e),debug:(e,t)=>console.debug(t,e),trace(){},silent(){},redact(e){return e},addRedactPattern(){}})}let O=ge();const me={},ie=e=>{const t=new Array;return{[Symbol.iterator]:()=>t[Symbol.iterator](),get size(){return t.length},add:a=>{e!==0&&(t.length<e?t.splice(e,0,a):(t.shift(),t.push(a)))},clear:()=>{t.length=0},entries:()=>t.entries()}},ye="Anonymous",be="AnonymousSignal",ve=2;function T(e){return e.name||ye}function p(e={variant:"generic"}){const{allowEmittingWithoutObserver:t=!1,variant:a="generic",name:r=be}=e??{},o=new Set,u=new WeakMap,d=new WeakSet;let E=!1,b=!1,f;switch(e?.variant){case"batched":case"replay":{if(e.bufferSize!==void 0&&e.bufferSize<1)throw new Error("Batched/Replay Signal bufferSize must be greater than 0");if(e.bufferSize===1){const l={bufferSize:e.bufferSize,name:r,variant:a};switch(e.variant){case"batched":e.emitImmediatelyWhenFull&&O.warn(l,"Batched signal with buffer size of 1 is basically a Generic signal");break;case"replay":O.warn(l,"Replay signal with bufferSize of 1 is identical to Behavior signal");break}}f=ie(e.bufferSize??ve);break}case"behavior":{f=ie(1);break}}if(e?.variant==="batched"&&e.schedule===void 0)throw new Error("Batched signal requires a scheduler to be provided in the options");function R(l,g){try{const m=u.get(l);O.trace({signal:r,variant:a,subject:g,observer:l,context:m},`Emitting a subject to observer ${T(l)}`),l.call(m,g),d.has(l)&&k(l)}catch(m){throw O.error({signal:r,variant:a,error:m,observer:l,subject:g},`emit with error for observer ${T(l)}`),m instanceof RangeError?new RangeError(`RangeError: Possible recursive call when calling ${T(l)} for ${r}`):m}}const I=(l,g)=>{if(o.has(l)){const m=`Observer ${T(l)} has already been added!`;throw O.error({signal:r,variant:a,observer:l},m),new Error(`DuplicatedObserver: ${m}`)}switch(O.trace({signal:r,variant:a,observer:l},`Adding ${T(l)} to ${r}`),o.add(l),g&&u.set(l,g),a){case"replay":case"behavior":{for(const m of f??[])R(l,m);break}}return()=>k(l)},v=(l,g)=>{if(d.has(l)){const m=`${T(l)} has already been added once to ${r}!`;throw O.error({signal:r,variant:a,observer:l},m),new Error(`NoOnceAgain: ${m}`)}return d.add(l),I(l,g)},k=l=>{if(!o.delete(l))throw O.error({signal:r,variant:a,observer:l},`Unable to remove observer ${T(l)}`),new Error(`UnableToRemove: ${T(l)}`);d.delete(l),u.delete(l),O.trace({signal:r,variant:a,observer:l},`Removed ${T(l)} from ${r}`)},$=()=>o.size,B=()=>{if(!b||!f||f.size<1)return;const l=[];for(const g of f)g!==void 0&&l.push(g);f.clear();for(const g of o)R(g,l);E=!1,b=!1};function j(l){if(f)f.add(l);else if(!o.size&&!t){const{stack:g}=me.debug?new Error:{stack:void 0};O.warn({signal:r,variant:a,subject:l,stack:g},`Emitting ${r} without any observer! This may be a mistake.`)}switch(e.variant){case"batched":{e.emitImmediatelyWhenFull&&f?.size===e.bufferSize?(b=!0,B()):!E&&f?.size===1&&(E=!0,b=!0,e.schedule(B));break}default:{for(const g of o)R(g,l);break}}}return{name:r,get size(){return $()},add:I,addOnce:v,remove:k,emit:j}}var oe;(function(e){e[e.trace=10]="trace",e[e.debug=20]="debug",e[e.info=30]="info",e[e.warn=40]="warn",e[e.error=50]="error",e[e.fatal=60]="fatal",e[e.silent=9007199254740991]="silent"})(oe||(oe={}));function Ee(){return Object.freeze({fatal:(e,t)=>console.error(t,e),error:(e,t)=>console.error(t,e),warn:(e,t)=>console.warn(t,e),info:(e,t)=>console.info(t,e),debug:(e,t)=>console.debug(t,e),trace(){},silent(){},redact(e){return e},addRedactPattern(){}})}let U=Ee();function ke(e){return typeof e=="string"&&e.length>0}function Ce(e){return!!(e&&typeof e=="object"&&"chanId"in e&&"event"in e)}function Re(e){return!!(e&&typeof e=="object"&&"chanId"in e&&"replyTo"in e)}const y=[];for(let e=0;e<256;++e)y.push((e+256).toString(16).slice(1));function Pe(e,t=0){return(y[e[t+0]]+y[e[t+1]]+y[e[t+2]]+y[e[t+3]]+"-"+y[e[t+4]]+y[e[t+5]]+"-"+y[e[t+6]]+y[e[t+7]]+"-"+y[e[t+8]]+y[e[t+9]]+"-"+y[e[t+10]]+y[e[t+11]]+y[e[t+12]]+y[e[t+13]]+y[e[t+14]]+y[e[t+15]]).toLowerCase()}let N;const xe=new Uint8Array(16);function Ie(){if(!N){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");N=crypto.getRandomValues.bind(crypto)}return N(xe)}const Se=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),se={randomUUID:Se};function We(e,t,a){if(se.randomUUID&&!e)return se.randomUUID();e=e||{};const r=e.random??e.rng?.()??Ie();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Pe(r)}function ue(e){return`${e?`${e}-`:""}${We()}`}function Oe(){const e=new Map,t=new Set;return window.onbeforeunload=()=>{for(const d of t)clearInterval(d);t.clear()},{add:(d,E)=>{if(e.has(d)){U.warn(`A popup with with ID:'${d}' has already been registered`);return}e.set(d,{popup:null,shouldOpen:E})},remove:d=>{e.delete(d)},open:(d,E,b)=>{e.has(d)||e.set(d,{popup:null});const f=e.get(d);if(f?.popup&&!f.popup.closed){U.warn(`Popup with ID:'${d}' is currently opened`);return}if(e.get(d)?.shouldOpen&&!e.get(d)?.shouldOpen?.(b??{}))return;const R=window.open(...E);if(f&&(f.popup=R),R){const I=window.setInterval(()=>{if(R.closed){const v=e.get(d);v&&(v.popup=null),clearInterval(I),t.delete(I)}},500);t.add(I)}},get:d=>e.get(d)?.popup}}class Me{constructor(t,a){this.target=t,this.chanId=a,this.pendingCalls=new Map,this.eventListeners=new Set,this.onMessage=r=>{if(r.data.chanId!==this.chanId)return;const o=r.data;if(U.debug({evt:r},`Message received for channel ${this.chanId}`),Re(o)){const[u,d]=this.pendingCalls.get(o.replyTo)??[];if(!u){U.debug({evt:r},"Resolve fn doesnt exist");return}this.pendingCalls.delete(o.replyTo),u(o.payload)}if(Ce(o))for(const u of this.eventListeners)u(o)},globalThis.addEventListener("message",this.onMessage)}addEventListener(t){this.eventListeners.add(t)}removeEventListener(t){this.eventListeners.delete(t)}emitEvent(t){this.target.postMessage({chanId:this.chanId,...t},"*")}callRPC(t,a,r){const o=ue();return U.debug({payload:a,id:o},`'${t}' called for channel ${this.chanId}`),new Promise((u,d)=>{this.pendingCalls.set(o,[u,d]),this.target.postMessage({rpc:t,payload:a,id:o,chanId:this.chanId},"*",r)})}replyRPC(t){this.emitEvent(t)}sendEvent(t){this.emitEvent(t)}unregister(){globalThis.removeEventListener("message",this.onMessage)}get targetWindow(){return this.target}}var ce;(function(e){e.audio="audio",e.video="video",e.api="api"})(ce||(ce={}));var le;(function(e){e[e.Join=0]="Join",e[e.Leave=1]="Leave",e[e.Update=2]="Update"})(le||(le={}));const Te=e=>{const t=new Map,a=new Map,r=new Map,o=new Map,u=new Map,d=p({allowEmittingWithoutObserver:!0}),E=p({allowEmittingWithoutObserver:!0}),b=p({allowEmittingWithoutObserver:!0}),f=p({allowEmittingWithoutObserver:!0}),R=p({allowEmittingWithoutObserver:!0}),I=p({allowEmittingWithoutObserver:!0}),v=p({allowEmittingWithoutObserver:!0}),k=p({allowEmittingWithoutObserver:!0}),$=p({allowEmittingWithoutObserver:!0}),B=p({allowEmittingWithoutObserver:!0}),j=p({allowEmittingWithoutObserver:!0}),l=p({allowEmittingWithoutObserver:!0}),g=p({allowEmittingWithoutObserver:!0}),m=p({allowEmittingWithoutObserver:!0}),L=p({allowEmittingWithoutObserver:!0}),_=p({allowEmittingWithoutObserver:!0}),G=p({allowEmittingWithoutObserver:!0}),K=p({allowEmittingWithoutObserver:!0}),Z=p({allowEmittingWithoutObserver:!0}),Q=p({allowEmittingWithoutObserver:!0}),ee=p({allowEmittingWithoutObserver:!0}),te=p({allowEmittingWithoutObserver:!0}),ne=p({allowEmittingWithoutObserver:!0});e.addEventListener(n=>{switch(n.event){case"ui:button:click":t.get(n.payload.buttonId)?.onClick.emit(n.payload.input);break;case"ui:form:input":r.get(n.payload.modalId)?.onInput.emit(n.payload.input);break;case"ui:prompt:input":o.get(n.payload.modalId)?.onInput.emit(n.payload.input);break;case"ui:widget:onLoad":u.get(n.payload.widgetId)?.onLoad.emit();break;case"ui:widget:onToggle":u.get(n.payload.widgetId)?.onToggle.emit(n.payload);break;case"participant:disconnected":a.get(n.payload.participantUuid)?.onDisconnect.emit(),a.delete(n.payload.participantUuid);break;case"event:conferenceStatus":E.emit(n.payload);break;case"event:connected":b.emit(n.payload);break;case"event:disconnected":f.emit(n.payload);break;case"event:userInitiatedDisconnect":R.emit(n.payload);break;case"event:me":I.emit(n.payload);break;case"event:message":l.emit(n.payload);break;case"event:directMessage":g.emit(n.payload);break;case"event:applicationMessage":m.emit(n.payload);break;case"event:transfer":L.emit(n.payload);break;case"event:cancelTransfer":_.emit(n.payload);break;case"event:stage":G.emit(n.payload);break;case"event:participants":v.emit(n.payload);break;case"event:participantLeft":$.emit(n.payload),a.get(n.payload.participant.uuid)?.onDisconnect.emit(),a.delete(n.payload.participant.uuid);break;case"event:participantJoined":k.emit(n.payload);break;case"event:participantsActivities":B.emit(n.payload);break;case"event:raiseHand":j.emit(n.payload);break;case"event:presentationConnectionStateChange":K.emit(n.payload);break;case"event:layoutUpdate":Z.emit(n.payload);break;case"event:conference:authenticated":d.emit(n.payload);break;case"event:breakoutBegin":Q.emit(n.payload);break;case"event:breakoutEnd":ee.emit(n.payload);break;case"event:breakoutRefer":te.emit(n.payload);break;case"event:languageSelect":ne.emit(n.payload);break}});const D=async(n,s)=>{const h=await e.callRPC("ui:removeElement",{id:n});if(h.status==="failed")return Promise.reject({reason:h.reason});s&&s()};return{app:{setDisconnectDestination:async n=>await e.callRPC("app:setDisconnectDestination",n)},ui:{addButton:async n=>{const s=await e.callRPC("ui:button:add",n);if(s.status==="failed")return Promise.reject({reason:s.reason});const h={onClick:p({allowEmittingWithoutObserver:!0}),update:async C=>{const P=await e.callRPC("ui:button:update",{...C,targetId:s.id});return P.status==="failed"?Promise.reject({reason:P.reason}):P.data},remove:()=>D(s.id,()=>t.delete(s.id))};return t.set(s.id,h),h},addForm:async n=>{const s=await e.callRPC("ui:form:open",n);if(s.status==="failed")return Promise.reject({reason:s.reason});const h={onInput:p(),remove:()=>D(s.id,()=>r.delete(s.id))};return r.set(s.id,h),h},showForm:async n=>{const s=await e.callRPC("ui:form:open",n);return s.status==="failed"?Promise.reject({reason:s.reason}):new Promise(h=>{const C=P=>{P.event==="ui:form:input"&&P.payload.modalId===s.id&&(h(P.payload.input),D(s.id),e.removeEventListener(C))};e.addEventListener(C)})},addPrompt:async n=>{const s=await e.callRPC("ui:prompt:open",n);if(s.status==="failed")return Promise.reject({reason:s.reason});const h={onInput:p(),remove:()=>D(s.id,()=>o.delete(s.id))};return o.set(s.id,h),h},showPrompt:async n=>{const s=await e.callRPC("ui:prompt:open",n);return s.status==="failed"?Promise.reject({reason:s.reason}):new Promise(h=>{const C=P=>{P.event==="ui:prompt:input"&&P.payload.modalId===s.id&&(h(P.payload.input),D(s.id),e.removeEventListener(C))};e.addEventListener(C)})},showToast:async n=>{const s=await e.callRPC("ui:toast:show",n);if(s.status==="failed")return Promise.reject({reason:s.reason})},addWidget:async n=>{const s=await e.callRPC("ui:widget:add",n);if(s.status==="failed")return Promise.reject({reason:s.reason});const h={id:s.id,onLoad:p({allowEmittingWithoutObserver:!0}),onToggle:p({allowEmittingWithoutObserver:!0}),toggle:async()=>{const C=await e.callRPC("ui:widget:toggle",{id:s.id});return C.status==="failed"?Promise.reject({reason:C.reason}):C.data},remove:()=>D(s.id,()=>o.delete(s.id))};return u.set(s.id,h),h}},conference:{dialOut:async n=>{let s;const h=new Map;let C=()=>{};const P=new Promise(we=>{C=k.add(({participant:F})=>{s?s.data.result.includes(F.uuid)&&we(F):h.set(F.uuid,F)})});s=await e.callRPC("conference:dialOut",n);const A=s?.data.result[0];if(!ke(A))throw Error("Could not dial out to specified uri");const he=h.get(A)??await P;C();const re={...he,onDisconnect:p({allowEmittingWithoutObserver:!0}),disconnect:async()=>(a.delete(A),e.callRPC("participant:disconnect",{participantUuid:A}))};return a.set(A,re),re},sendMessage:async n=>await e.callRPC("conference:sendMessage",n),sendApplicationMessage:async n=>await e.callRPC("conference:sendApplicationMessage",n),lock:async n=>await e.callRPC("conference:lock",n),muteAllGuests:async n=>await e.callRPC("conference:muteAllGuests",n),setBandwidth:async n=>await e.callRPC("conference:setBandwidth",n),setLayout:async n=>await e.callRPC("conference:setLayout",n),disconnectAll:async n=>await e.callRPC("conference:disconnectAll",n),requestParticipants:async n=>await e.callRPC("conference:requestParticipants",n),sendRequest:async n=>await e.callRPC("conference:sendRequest",n),transfer:async n=>await e.callRPC("participant:transfer",n),mute:async n=>await e.callRPC("participant:mute",n),muteVideo:async n=>await e.callRPC("participant:muteVideo",n),spotlight:async n=>await e.callRPC("participant:spotlight",n),admit:async n=>await e.callRPC("participant:admit",n),raiseHand:async n=>await e.callRPC("participant:raiseHand",n),setRole:async n=>await e.callRPC("participant:setRole",n),setTextOverlay:async n=>await e.callRPC("participant:setTextOverlay",n),sendDTMF:async n=>await e.callRPC("participant:sendDTMF",n),disconnect:async n=>{const s=n.participantUuid;return a.delete(s),await e.callRPC("participant:disconnect",{participantUuid:s})},breakout:async n=>await e.callRPC("conference:breakout",n),joinBreakoutRoom:async n=>await e.callRPC("conference:joinBreakoutRoom",n),closeBreakouts:async()=>await e.callRPC("conference:closeBreakouts",{}),closeBreakoutRoom:async n=>await e.callRPC("conference:closeBreakoutRoom",n),emptyBreakouts:async()=>await e.callRPC("conference:emptyBreakouts",{}),breakoutMoveParticipants:async n=>await e.callRPC("conference:breakoutMoveParticipants",n),getCurrentRoomId:async()=>await e.callRPC("conference:currentRoomId",void 0)},events:{authenticatedWithConference:d,conferenceStatus:E,connected:b,disconnected:f,userInitiatedDisconnect:R,me:I,message:l,directMessage:g,applicationMessage:m,transfer:L,cancelTransfer:_,stage:G,participants:v,participantJoined:k,participantLeft:$,participantsActivities:B,raiseHand:j,presentationConnectionStateChange:K,layoutUpdate:Z,breakoutBegin:Q,breakoutEnd:ee,breakoutRefer:te,languageSelect:ne}}};async function ze(e){window.plugin={popupManager:Oe()};const t=new Me(window.parent,ue(e.id)),a=await t.callRPC("syn",e);if(!a.ack)throw new Error(`Can't register plugin. ${JSON.stringify(a)}`);return Te(t)}let x={strokes:[],isActive:!1},c=null,i=null,V=!1,z=null,S="",H="#000000",q=3,M=!1,w=!0;const W=await ze({id:"whiteboard",version:0}),Be={custom:{main:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M0 96C0 60.7 28.7 32 64 32H448c35.3 0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96zm64 0v64h64V96H64zm384 0H192v64H448V96zM64 224v64h64V224H64zm384 0H192v64H448V224zM64 352v64h64V352H64zm384 0H192v64H448V352z" fill="rgb(43, 64, 84)"/></svg>',hover:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M0 96C0 60.7 28.7 32 64 32H448c35.3 0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96zm64 0v64h64V96H64zm384 0H192v64H448V96zM64 224v64h64V224H64zm384 0H192v64H448V224zM64 352v64h64V352H64zm384 0H192v64H448V352z" fill="white"/></svg>'}},$e=async()=>{S="user-"+Date.now(),(await W.ui.addButton({position:"toolbar",tooltip:"Whiteboard",icon:Be})).onClick.add(async()=>{try{x.isActive?await J():await De()}catch(t){console.error("Whiteboard button error:",t)}})};await $e();async function De(){try{await W.conference.sendApplicationMessage({payload:{type:"whiteboard-open",userId:S}}),x.isActive=!0,pe(),await W.ui.showToast({message:"Whiteboard opened - Click and drag to draw. Press ESC or click Close to exit.",isInterrupt:!0})}catch(e){console.error("Error opening whiteboard:",e)}}async function J(){try{await W.conference.sendApplicationMessage({payload:{type:"whiteboard-close",userId:S}}),x.isActive=!1,fe(),await W.ui.showToast({message:"Whiteboard closed",isInterrupt:!0})}catch(e){console.error("Error closing whiteboard:",e)}}function pe(){const e=parent.document.querySelector('div[data-testid="in-meeting-video-wrapper"]');if(!e)throw new Error("Could not find video wrapper to attach whiteboard.");const t=document.createElement("div");if(t.id="whiteboard-container",t.style.cssText=`
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    pointer-events: auto;
    background: ${w?"white":"transparent"};
    border: ${w?"2px solid #ccc":"none"};
  `,c=document.createElement("canvas"),c.id="whiteboard-canvas",c.style.cssText=`
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    cursor: crosshair;
    background: ${w?"white":"transparent"};
  `,c.width=e.clientWidth,c.height=e.clientHeight,i=c.getContext("2d"),!i)throw new Error("Could not get canvas context");i.lineCap="round",i.lineJoin="round",i.strokeStyle=M?w?"#ffffff":"#000000":H,i.lineWidth=M?10:q,w&&(i.fillStyle="#ffffff",i.fillRect(0,0,c.width,c.height)),t.appendChild(c),e.appendChild(t),c.addEventListener("mousedown",He),c.addEventListener("mousemove",Ae),c.addEventListener("mouseup",de),c.addEventListener("mouseleave",de),c.addEventListener("touchstart",Ue),c.addEventListener("touchmove",Ve),c.addEventListener("touchend",je);const a=document.createElement("div");a.style.cssText=`
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 1001;
    display: flex;
    gap: 5px;
    background: rgba(0, 0, 0, 0.8);
    padding: 8px;
    border-radius: 8px;
    flex-wrap: wrap;
  `;const r=document.createElement("button");r.textContent="âœ•",r.title="Close Whiteboard",r.style.cssText=`
    padding: 8px 12px;
    background: rgba(220, 53, 69, 0.8);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
  `,r.addEventListener("click",async()=>{await J()}),a.appendChild(r);const o=document.createElement("button");o.textContent="ðŸ—‘ï¸",o.title="Clear All",o.style.cssText=`
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  `,o.addEventListener("click",Ne),a.appendChild(o);const u=document.createElement("button");u.textContent="â†¶",u.title="Undo Last Stroke",u.style.cssText=`
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  `,u.addEventListener("click",qe),a.appendChild(u);const d=["#000000","#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#ffa500"],E=document.createElement("div");E.style.cssText=`
    display: flex;
    gap: 3px;
    align-items: center;
  `,d.forEach(v=>{const k=document.createElement("button");k.style.cssText=`
      width: 24px;
      height: 24px;
      border: 2px solid ${v===H?"#fff":"#ccc"};
      border-radius: 50%;
      background: ${v};
      cursor: pointer;
      margin: 0;
    `,k.title=`Color: ${v}`,k.addEventListener("click",()=>{H=v,M=!1,i&&(i.strokeStyle=v,i.lineWidth=q),R()}),E.appendChild(k)}),a.appendChild(E);const b=document.createElement("button");b.textContent="ðŸ§½",b.title="Eraser",b.style.cssText=`
    padding: 8px 12px;
    background: ${M?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.7)"};
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  `,b.addEventListener("click",()=>{M=!M,i&&(M?(i.strokeStyle=w?"#ffffff":"#000000",i.lineWidth=10):(i.strokeStyle=H,i.lineWidth=q)),R()}),a.appendChild(b);const f=document.createElement("button");f.textContent=w?"â¬œ":"â¬›",f.title=w?"Switch to Transparent":"Switch to White",f.style.cssText=`
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  `,f.addEventListener("click",()=>{w=!w,f.textContent=w?"â¬œ":"â¬›",f.title=w?"Switch to Transparent":"Switch to White",t.style.background=w?"white":"transparent",t.style.border=w?"2px solid #ccc":"none",c.style.background=w?"white":"transparent",i&&(w?(i.fillStyle="#ffffff",i.fillRect(0,0,c.width,c.height)):i.clearRect(0,0,c.width,c.height),M&&(i.strokeStyle=w?"#ffffff":"#000000"))}),a.appendChild(f);const R=()=>{E.querySelectorAll("button").forEach((k,$)=>{const B=d[$];k.style.border=`2px solid ${B===H?"#fff":"#ccc"}`}),b.style.background=M?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.7)"};t.appendChild(a);const I=async v=>{v.key==="Escape"&&await J()};document.addEventListener("keydown",I),t.keydownHandler=I,X()}function fe(){const e=parent.document.getElementById("whiteboard-container");if(e){const t=e.keydownHandler;t&&document.removeEventListener("keydown",t),e.remove()}c=null,i=null,V=!1,z=null}function He(e){if(!c||!i)return;V=!0;const t=c.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top;z={points:[{x:a,y:r}],color:M?w?"#ffffff":"#000000":H,width:i.lineWidth,timestamp:Date.now(),userId:S},i.beginPath(),i.moveTo(a,r)}function Ae(e){if(!V||!c||!i||!z)return;const t=c.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top;z.points.push({x:a,y:r}),i.lineTo(a,r),i.stroke(),Fe(z)}function de(){!V||!z||(V=!1,x.strokes.push(z),z=null)}function Ue(e){if(e.preventDefault(),!c)return;const t=e.touches[0],a=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});c.dispatchEvent(a)}function Ve(e){if(e.preventDefault(),!c)return;const t=e.touches[0],a=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});c.dispatchEvent(a)}function je(e){if(e.preventDefault(),!c)return;const t=new MouseEvent("mouseup",{});c.dispatchEvent(t)}function Fe(e){try{W.conference.sendApplicationMessage({payload:{type:"whiteboard-draw",stroke:e,userId:S}})}catch(t){console.error("Error sending drawing data:",t)}}function Ne(){if(!(!c||!i)){w?(i.fillStyle="#ffffff",i.fillRect(0,0,c.width,c.height)):i.clearRect(0,0,c.width,c.height),x.strokes=[];try{W.conference.sendApplicationMessage({payload:{type:"whiteboard-clear",userId:S}})}catch(e){console.error("Error sending clear message:",e)}}}function qe(){if(!(!c||!i||x.strokes.length===0)){x.strokes.pop(),X();try{W.conference.sendApplicationMessage({payload:{type:"whiteboard-undo",userId:S}})}catch(e){console.error("Error sending undo message:",e)}}}function X(){if(!(!c||!i)){w?(i.fillStyle="#ffffff",i.fillRect(0,0,c.width,c.height)):i.clearRect(0,0,c.width,c.height);for(const e of x.strokes)if(e.points.length!==0){i.strokeStyle=e.color,i.lineWidth=e.width,i.beginPath(),i.moveTo(e.points[0].x,e.points[0].y);for(let t=1;t<e.points.length;t++)i.lineTo(e.points[t].x,e.points[t].y);i.stroke()}}}W.events.applicationMessage.add(async e=>{const t=e.message,a=e.participantId||e.userId||"unknown";try{switch(t.type){case"whiteboard-open":a!==S&&(x.isActive=!0,pe(),await W.ui.showToast({message:`${e.displayName} opened the whiteboard`,isInterrupt:!0}));break;case"whiteboard-close":a!==S&&(x.isActive=!1,fe(),await W.ui.showToast({message:`${e.displayName} closed the whiteboard`,isInterrupt:!0}));break;case"whiteboard-draw":if(a!==S&&c&&i){const r=t.stroke;if(x.strokes.push(r),i.strokeStyle=r.color,i.lineWidth=r.width,i.beginPath(),r.points.length>0){i.moveTo(r.points[0].x,r.points[0].y);for(let o=1;o<r.points.length;o++)i.lineTo(r.points[o].x,r.points[o].y)}i.stroke()}break;case"whiteboard-clear":a!==S&&(x.strokes=[],c&&i&&(w?(i.fillStyle="#ffffff",i.fillRect(0,0,c.width,c.height)):i.clearRect(0,0,c.width,c.height)));break;case"whiteboard-undo":a!==S&&(x.strokes.pop(),X());break}}catch(r){console.error("Error handling application message:",r)}});const Y=document.createElement("link");Y.rel="stylesheet";Y.href=Je()+"/style.css";parent.document.head.appendChild(Y);function Je(){return window.location.pathname.slice(0,window.location.pathname.lastIndexOf("/"))}
